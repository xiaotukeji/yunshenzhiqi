(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{562:function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return c})),n.d(e,"a",(function(){return l})),n.d(e,"d",(function(){return d}));var o=n(1);function r(t){return Object(o.a)({url:"/api/pay/info",data:t,forceLogin:!0})}function c(t){return Object(o.a)({url:"/api/pay/type",data:t,forceLogin:!0})}function l(t){return Object(o.a)({url:"/api/pay/status",data:t,forceLogin:!0})}function d(t){return Object(o.a)({url:"/api/pay/pay",data:t,forceLogin:!0})}},579:function(t,e,n){},580:function(t,e,n){},664:function(t,e,n){"use strict";n(579)},665:function(t,e,n){"use strict";n(580)},759:function(t,e,n){"use strict";n.r(e);n(56),n(7),n(18),n(208),n(73);var o=n(562),r=n(33),c={name:"pay",components:{},data:function(){return{orderOpen:!1,outTradeNo:"",payInfo:{pay_money:0},payIndex:0,payTypeList:[{name:"支付宝支付",icon:"iconzhifubaozhifu-",type:"alipay"},{name:"微信支付",icon:"iconweixinzhifu",type:"wechatpay"}],payUrl:"",timer:null,payQrcode:"",openQrcode:!1,loading:!0,test:null,dialogVisible:!1}},created:function(){this.$route.query.code?(this.outTradeNo=this.$route.query.code,this.getPayInfo(),this.getPayType()):this.$router.push({path:"/"})},methods:{getPayInfo:function(){var t=this;Object(o.b)({out_trade_no:this.outTradeNo,forceLogin:!0}).then((function(e){e.code,e.message;e.data&&(t.payInfo=e.data),t.loading=!1})).catch((function(e){t.loading=!1,t.$message.error({message:e.message,duration:2e3,onClose:function(){t.$router.push({path:"/member/order_list"})}})}))},getPayType:function(){var t=this;Object(o.c)({}).then((function(e){var code=e.code;e.message,e.data;code>=0&&(""==e.data.pay_type?t.payTypeList=[]:t.payTypeList.forEach((function(n,o){-1==e.data.pay_type.indexOf(n.type)&&t.payTypeList.splice(o,1)})))})).catch((function(e){t.$message.error(e.message)}))},checkPayStatus:function(){var t=this;this.timer=setInterval((function(){Object(o.a)({out_trade_no:t.outTradeNo}).then((function(e){var code=e.code,data=(e.message,e.data);code>=0&&(0==code?2==data.pay_status&&(clearInterval(t.timer),t.dialogVisible=!1,t.$router.push({path:"/pay/result?code="+t.payInfo.out_trade_no})):clearInterval(t.timer))})).catch((function(e){clearInterval(t.timer),t.$router.push({path:"/"})}))}),2e3)},pay:function(){var t=this,e=this.payTypeList[this.payIndex];if(e){var n=encodeURIComponent(r.a.webDomain+"/pay/result?code="+this.outTradeNo);Object(o.d)({out_trade_no:this.payInfo.out_trade_no,pay_type:e.type,app_type:"pc",return_url:n}).then((function(n){var code=n.code,o=n.message;n.data;if(code>=0)switch(t.checkPayStatus(),e.type){case"alipay":t.payUrl=n.data.data,window.open(t.payUrl),t.open();break;case"wechatpay":t.payQrcode=n.data.qrcode,t.openQrcode=!0}else t.$message({message:o,type:"warning"})})).catch((function(e){t.$message.error(e.message)}))}},open:function(){this.dialogVisible=!0},goIndex:function(){clearInterval(this.timer),this.dialogVisible=!1,this.$router.push({path:"/"})},goOrderList:function(){clearInterval(this.timer),this.dialogVisible=!1,this.$router.push({path:"/member/order_list"})}}},l=(n(664),n(665),n(6)),component=Object(l.a)(c,(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"pay-wrap"},[e("div",{staticClass:"item-block"},[e("div",{staticClass:"payment-detail"},[e("div",{staticClass:"payment-media"},[e("el-row",[e("el-col",{attrs:{span:4}},[e("div",{staticClass:"media-left"},[e("i",{staticClass:"el-icon-circle-check ns-text-color"})])]),t._v(" "),e("el-col",{attrs:{span:16}},[e("div",{staticClass:"media-body"},[e("el-row",[e("el-col",{attrs:{span:12}},[e("div",{staticClass:"payment-text"},[t._v("您的订单已提交成功，正在等待处理！")]),t._v(" "),e("div",[e("span",[t._v("应付金额：")]),t._v(" "),e("span",{staticClass:"payment-money ns-text-color"},[t._v("￥"+t._s(t.payInfo.pay_money)+"元")])])]),t._v(" "),e("el-col",{attrs:{span:12}})],1)],1)]),t._v(" "),e("el-col",{attrs:{span:4}},[e("div",{staticClass:"media-right"},[e("div",{staticClass:"el-button--text",on:{click:function(e){t.orderOpen?t.orderOpen=!1:t.orderOpen=!0}}},[t._v("\n                订单信息\n                "),e("i",{staticClass:"el-icon-arrow-down",class:t.orderOpen?"rotate":""})])])])],1)],1),t._v(" "),t.orderOpen?e("div",{staticClass:"order-info"},[e("el-row",[e("el-col",{staticClass:"order-info-left",attrs:{span:4}}),t._v(" "),e("el-col",{attrs:{span:20}},[e("div",{staticClass:"line"}),t._v(" "),e("div",{staticClass:"order-item"},[e("div",{staticClass:"item-label"},[t._v("交易单号：")]),t._v(" "),e("div",{staticClass:"item-value"},[t._v(t._s(t.payInfo.out_trade_no))])]),t._v(" "),e("div",{staticClass:"order-item"},[e("div",{staticClass:"item-label"},[t._v("订单内容：")]),t._v(" "),e("div",{staticClass:"item-value"},[t._v(t._s(t.payInfo.pay_detail))])]),t._v(" "),e("div",{staticClass:"order-item"},[e("div",{staticClass:"item-label"},[t._v("订单金额：")]),t._v(" "),e("div",{staticClass:"item-value"},[t._v("￥"+t._s(t.payInfo.pay_money))])]),t._v(" "),e("div",{staticClass:"order-item"},[e("div",{staticClass:"item-label"},[t._v("创建时间：")]),t._v(" "),e("div",{staticClass:"item-value"},[t._v(t._s(t.$timeStampTurnTime(t.payInfo.create_time)))])])])],1)],1):t._e()])]),t._v(" "),e("div",{staticClass:"item-block"},[e("div",{staticClass:"block-text"},[t._v("支付方式")]),t._v(" "),t.payTypeList.length?e("div",{staticClass:"pay-type-list"},[t._l(t.payTypeList,(function(n,o){return e("div",{key:o,staticClass:"pay-type-item",class:t.payIndex==o?"active":"",on:{click:function(e){t.payIndex=o}}},[t._v("\n        "+t._s(n.name)+"\n      ")])})),t._v(" "),e("div",{staticClass:"clear"})],2):e("div",{staticClass:"no-pay-type"},[e("p",[t._v("商家未配置支付方式")])])]),t._v(" "),t.payTypeList.length?e("div",{staticClass:"item-block"},[e("div",{staticClass:"order-submit"},[e("el-button",{staticClass:"el-button--primary",attrs:{type:"primary"},on:{click:t.pay}},[t._v("立即支付")])],1),t._v(" "),e("div",{staticClass:"clear"})]):t._e(),t._v(" "),e("el-dialog",{staticClass:"confirm-pay-wrap",attrs:{title:"请确认支付是否完成",visible:t.dialogVisible,width:"23%",top:"30vh"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("div",{staticClass:"info-wrap"},[e("i",{staticClass:"el-message-box__status el-icon-warning"}),t._v(" "),e("span",[t._v("完成支付前请根据您的情况点击下面的按钮")])]),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small"},on:{click:t.goIndex}},[t._v("返回首页")]),t._v(" "),e("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.goOrderList}},[t._v("已完成支付")])],1)]),t._v(" "),e("el-dialog",{attrs:{title:"请用微信扫码支付",visible:t.openQrcode,width:"300px",center:""},on:{"update:visible":function(e){t.openQrcode=e}}},[e("div",{staticClass:"wechatpay-box"},[e("img",{attrs:{src:t.payQrcode}})])])],1)}),[],!1,null,"9b98d834",null);e.default=component.exports}}]);